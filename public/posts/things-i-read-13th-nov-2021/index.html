<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>for vs list comprehension - Random stuff</title><meta name="description" content="YLA's random stuff">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta itemprop="name" content="for vs list comprehension">
<meta itemprop="description" content="This is me writing down my discussion with someone from work regarding for loop vs list comprehension in Python.
During a code review, I was commenting on a chunk of code to change from for loop to a list comprehension. We also talked about why I wanted it that way. One reason is list comprehension could be (arguably) more readable than a for loop. For a simple loop, that might be the case."><meta itemprop="datePublished" content="2021-11-13T12:07:13+08:00" />
<meta itemprop="dateModified" content="2021-11-13T12:07:13+08:00" />
<meta itemprop="wordCount" content="445">
<meta itemprop="keywords" content="python,cpython,performance,optimizations," /><meta property="og:title" content="for vs list comprehension" />
<meta property="og:description" content="This is me writing down my discussion with someone from work regarding for loop vs list comprehension in Python.
During a code review, I was commenting on a chunk of code to change from for loop to a list comprehension. We also talked about why I wanted it that way. One reason is list comprehension could be (arguably) more readable than a for loop. For a simple loop, that might be the case." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.yelinaung.com/posts/things-i-read-13th-nov-2021/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-13T12:07:13+08:00" />
<meta property="article:modified_time" content="2021-11-13T12:07:13+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="for vs list comprehension"/>
<meta name="twitter:description" content="This is me writing down my discussion with someone from work regarding for loop vs list comprehension in Python.
During a code review, I was commenting on a chunk of code to change from for loop to a list comprehension. We also talked about why I wanted it that way. One reason is list comprehension could be (arguably) more readable than a for loop. For a simple loop, that might be the case."/>
<link rel="stylesheet" type="text/css" media="screen" href="https://blog.yelinaung.com/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://blog.yelinaung.com/css/main.css" />
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
	<h1 class="site-title"><a href="https://blog.yelinaung.com/">Random stuff</a></h1>
	<div class="site-description"><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/yelinaung" title="Github"><i data-feather="github"></i></a></li><li><a href="/index.xml" title="RSS"><i data-feather="rss"></i></a></li></ul>
		</nav></div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">All posts</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">13</span>
							<span class="rest">Nov 2021</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">for vs list comprehension</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>This is me writing down my discussion with someone from work regarding <code>for</code> loop vs list comprehension in Python.</p>
<p>During a code review, I was commenting on a chunk of code to change from <code>for</code> loop to a list comprehension.
We also talked about <em>why</em> I wanted it that way.
One reason is list comprehension could be (arguably) more readable than a <code>for</code> loop. For a simple loop, that might be the case.
Another reason is list comprehension is <em>faster</em> than the for loop. How fast? I have never tried comparing them before.
So I made a few examples to showcase that. These are from the excellent <a href="https://switowski.com/blog/for-loop-vs-list-comprehension">For Loop vs List Comprehension article</a>.</p>
<p>This is running on CPython 3.9.5</p>
<h3 id="for-loop">For loop</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#177500"># for_loop_append_list.py          </span>
<span style="color:#000">output</span> <span style="color:#000">=</span> []
<span style="color:#000">MILLION_NUMBERS</span> <span style="color:#000">=</span> <span style="color:#a90d91">list</span>(<span style="color:#a90d91">range</span>(<span style="color:#1c01ce">1_000_000</span>))

<span style="color:#a90d91">def</span> <span style="color:#000">for_loop</span>():
    <span style="color:#a90d91">for</span> <span style="color:#000">element</span> <span style="color:#000">in</span> <span style="color:#000">MILLION_NUMBERS</span>:
        <span style="color:#000">output</span><span style="color:#000">.</span><span style="color:#000">append</span>(<span style="color:#000">element</span>)

    <span style="color:#a90d91">return</span> <span style="color:#000">output</span>
</code></pre></div><p>Then try with <code>timeit</code> module.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python -m timeit <span style="color:#c41a16">&#39;from for_loop_append_list import for_loop&#39;</span> <span style="color:#c41a16">&#39;for_loop()&#39;</span> 
<span style="color:#1c01ce">5</span> loops, best of 5: 40.7 msec per loop  
</code></pre></div><h3 id="list-comprehension">List comprehension</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#177500"># list_comprehension_append_list.py </span>
<span style="color:#000">MILLION_NUMBERS</span> <span style="color:#000">=</span> <span style="color:#a90d91">list</span>(<span style="color:#a90d91">range</span>(<span style="color:#1c01ce">1_000_000</span>))

<span style="color:#a90d91">def</span> <span style="color:#000">list_comprehension</span>():
    <span style="color:#a90d91">return</span> [<span style="color:#000">number</span> <span style="color:#a90d91">for</span> <span style="color:#000">number</span> <span style="color:#000">in</span> <span style="color:#000">MILLION_NUMBERS</span>]
</code></pre></div><p>Running it</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python -m timeit <span style="color:#c41a16">&#39;from list_comprehension_append_list import list_comprehension&#39;</span> <span style="color:#c41a16">&#39;list_comprehension()&#39;</span>                                  
<span style="color:#1c01ce">20</span> loops, best of 5: 14.1 msec per loop
</code></pre></div><p>The numbers don&rsquo;t lie.
Of course, this is a very simplified example with a large number of items.
It might not matter much when we are going through small numbers of <code>n</code>.</p>
<p>We continue about why someone would prefer to use <code>for</code> loop in some situation such as when the line is really long with <code>if</code> condition or when there are two list comprehensions.
I agree with that. I would prefer (from the readability standpoint)</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#000">list_of_words</span> <span style="color:#000">=</span> []
<span style="color:#a90d91">for</span> <span style="color:#000">sentence</span> <span style="color:#000">in</span> <span style="color:#000">text</span>:
    <span style="color:#a90d91">for</span> <span style="color:#000">word</span> <span style="color:#000">in</span> <span style="color:#000">sentence</span>:
       <span style="color:#000">list_of_words</span><span style="color:#000">.</span><span style="color:#000">append</span>(<span style="color:#000">word</span>)
<span style="color:#a90d91">return</span> <span style="color:#000">list_of_words</span>
</code></pre></div><p>over</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">[<span style="color:#000">word</span> <span style="color:#a90d91">for</span> <span style="color:#000">sentence</span> <span style="color:#000">in</span> <span style="color:#000">text</span> <span style="color:#a90d91">for</span> <span style="color:#000">word</span> <span style="color:#000">in</span> <span style="color:#000">sentence</span>] 
</code></pre></div><p>With enough practice and usage, I think we can get used to the double list comprehension though so let&rsquo;s see.</p>
<p>The same goes for the comprehension with a long line with <code>if</code> and <code>else</code> ). Maybe <a href="https://black.readthedocs.io/en/stable/">black</a> will help if it&rsquo;s really long.</p>
<h3 id="why-is-the-list-comprehension-faster-actually">Why is the list comprehension faster actually?</h3>
<p>From StackOverflow</p>
<p><a href="https://stackoverflow.com/questions/30245397/why-is-a-list-comprehension-so-much-faster-than-appending-to-a-list/30245465#30245465">https://stackoverflow.com/questions/30245397/why-is-a-list-comprehension-so-much-faster-than-appending-to-a-list/30245465#30245465</a></p>
<ul>
<li>List comprehension is basically just a &ldquo;syntactic sugar&rdquo; for the regular for loop.</li>
<li>In this case the reason that it performs better is because it doesn&rsquo;t need to load the append attribute of the list and call it as a function at each iteration.</li>
<li>In other words and in general, list comprehensions perform faster because suspending and resuming a function&rsquo;s frame, or multiple functions in other cases, is slower than creating a list on demand.</li>
</ul>
<p>Adding &ldquo;learn more about python bytecodes&rdquo; and dive deep into the (in)famous <a href="https://github.com/python/cpython/blob/main/Python/ceval.c">ceval</a> code to my endless list of things to read!</p>

			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="/tags/python">python</a></li>
							
							<li><a href="/tags/cpython">cpython</a></li>
							
							<li><a href="/tags/performance">performance</a></li>
							
							<li><a href="/tags/optimizations">optimizations</a></li>
							
						</ul>
					
				
			</div></div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div>2021  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


</body>
</html>
